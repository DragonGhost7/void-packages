# Template file for 'python3-transifex-client'
pkgname=python3-transifex-client
version=0.14.3
revision=1
wrksrc="transifex-client-${version}"
build_style=python3-module
pycompile_module="txclib"
hostmakedepends="python3-setuptools python3-pip git"
depends="python3-urllib3 python3-requests python3-six python3-slugify python3-GitPython"
checkdepends="python3-pytest python3-mock python3-pytest-mock ${depends}"
# checkdepends="${depends}"
short_desc="Transifex command-line tool"
maintainer="Enno Boland <gottox@voidlinux.org>"
license="GPL-2.0-only"
homepage="https://www.transifex.com"
distfiles="https://github.com/transifex/transifex-client/archive/refs/tags/${version}.tar.gz"
checksum=51782378bf681914aec74b3d1e11ff8151f58ce0522f7e28b196061f6c3c3c41

pre_check() {
	vsed -i 's#python-slugify<5.0.0#python-slugify#' requirements.txt
	# vsed -e 's/envlist = py{27,39}-{vanilla,pyopenssl}/envlist = ,py310/' -i tox.ini
	vsed -e 's/python_requires=">=2.7,!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,<3.10"/python_requires=">=2.7,!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*"/' -i setup.py
}

do_check() {
	pytest -k 'not test_fetch_timestamp_from_git_tree'
	#requires to be in a git repo
}
